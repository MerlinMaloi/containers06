# Лабораторная работа №6

## Цель работы

Выполнив данную работу студент сможет управлять взаимодействием нескольких контейнеров.

## Задание

Создать php приложение на базе двух контейнеров: `nginx`, `php-fpm`.


## Выполнение 

### 1. Создание репозиория и директории

1. Создал репозиторий `containers06` и скопировал его себе на компьютер.

2. В директории `containers06` создаk директорию `mounts/site`. В данную директорию скопировал сайт на php, созданный в рамках предмета по php.

3. Создал файл `.gitignore` в корне проекта и записал в него строки:

```
# Ignore files and directories
mounts/site/*
```

4. Создаk в директории `containers06` файл `nginx/default.conf` со следующим содержимым:

```
server {
    listen 80;
    server_name _;
    root /var/www/html;
    index index.php;
    location / {
        try_files $uri $uri/ /index.php?$args;
    }
    location ~ \.php$ {
        fastcgi_pass backend:9000;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}
```

### 2. Запуск и тестирование

1. Создал сеть internal для контейнеров.

`docker network create internal`

2. Создал контейнер `backend` со следующими свойствами:

- на базе образа `php:7.4-fpm`;

- к контейнеру примонтирована директория `mounts/site` в `/var/www/html`;

- работает в сети `internal`.

`docker container run -d --name backend --network internal -v %cd%\mounts\site:/var/www/html php:7.4-fpm `



3. Создайте контейнер `frontend` со следующими свойствами:

- на базе образа `nginx:1.23-alpine`;

- с примонтированной директорией `mounts/site` в `/var/www/html`;

- с примонтированным файлом `nginx/default.conf` в `/etc/nginx/conf.d/default.conf`;

- порт 80 контейнера проброшен на порт 80 хоста;

- работает в сети internal.

`container run -d --name frontend --network internal -p 80:80 -v %cd%/mounts/site:/var/www/html -v %cd%/nginx/default.conf:/etc/nginx/conf.d/default.conf nginx:1.23-alpine`

4. Проверка работы сайта в браузере, по адресу `http://localhost`. Где сначала базовая страница `nginx`, а после перегрузки моя страницы `php`.


## Ответы на вопросы

1. **Каким образом в данном примере контейнеры могут взаимодействовать друг с другом?**
    
    - Через подключение к одной сети ,что позволяет им увидеть имена друг друга и  Docker DNS

2. **Как видят контейнеры друг друга в рамках сети internal?** 
    
    -  Контейнеры видят друг друга по именам

3. **Почему необходимо было переопределять конфигурацию nginx?** 
   
   - Чтобы указать, как обращаться к другим контейнерам по именам и портам , это нет в стандартной конфиге


### Выводы

В ходе работы я столкнулся со множестов трудностей , как мне подсказал коллега из-за использования powershell и его трудностей при монтировании , подробно еще требуется узнать решение у профессора . В остальном сухом остатке научился и обрел некоторое понимание взаимодействия контейнеров между собой посредством общей сети. 